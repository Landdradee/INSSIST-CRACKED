(async()=>{var e=Object.create,t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,o=(e,t)=>()=>(e&&(t=e(e=0)),t),s=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),c=(e,n)=>{for(var r in n)t(e,r,{get:n[r],enumerable:!0})},l=(e,i,o,s)=>{if(i&&typeof i==`object`||typeof i==`function`)for(var c=r(i),l=0,u=c.length,d;l<u;l++)d=c[l],!a.call(e,d)&&d!==o&&t(e,d,{get:(e=>i[e]).bind(null,d),enumerable:!(s=n(i,d))||s.enumerable});return e},u=(n,r,a)=>(a=n==null?{}:e(i(n)),l(r||!n||!n.__esModule?t(a,`default`,{value:n,enumerable:!0}):a,n)),d=e=>l(t({},`__esModule`,{value:!0}),e),f,ee=o((()=>{(()=>{let e=`production`,t=e===`development`;if(f=globalThis.app,f)return;let n={name:`app`,env:e,get:e=>e in n?n[e]:null,...JSON.parse(`{"version":"36.0.1","manifestVersion":3}`)},r=i(n);globalThis.app=r,t&&(globalThis.$app=n),f=r;function i(e){let r=e===n,s=r&&t,c={},l=t=>Object.assign(e,t);return new Proxy(e,{get(t,n){if(n===`assign`)return l;if(r&&!String(n).startsWith(`$`))return e[n];if(!(n in e)){if(e[n]={},r){let t=a.bind(null,`log`,n,!1),r=a.bind(null,`log`,n,!0),i=a.bind(null,`warn`,n,!1),s=a.bind(null,`warn`,n,!0),c=a.bind(null,`error`,n,!1),l=a.bind(null,`error`,n,!0),u=o.bind(null,n);Object.defineProperties(e[n],{log:{get:()=>t},logDev:{get:()=>r},warn:{get:()=>i},warnDev:{get:()=>s},error:{get:()=>c},errorDev:{get:()=>l},Error:{get:()=>u}})}c[n]=i(e[n]),s&&(globalThis[n]=e[n])}return n in c?c[n]:e[n]},set(t,n,r){return e[n]=r,c[n]=r,s&&(globalThis[n]=e[n]),!0}})}function a(e,n,r,...i){if(r&&!t)return;let[a,o,c]=s(n);console[e](`%c[${n}]`,`color: rgb(${a}, ${o}, ${c})`,...i)}function o(e,t,...n){return n.length>0&&a(`error`,e,!1,t,...n),Error(`[${e}] ${t}`)}function s(e){let t=0;e.split(``).forEach((n,r)=>{t=e.charCodeAt(r)+((t<<5)-t)});let n=(t&16711680)>>16,r=(t&65280)>>8,i=t&255;return n+r+i<300?s(`$${e}`):[n,r,i]}})()}));function te(e,t){return`${e}|${JSON.stringify(t)}`}function ne(){return window.self.name.split(`|`)[0]||null}function re(){let e=window.self.name.split(`|`)[1];return p.safeJsonParse(e)||{}}function ie(e=null){return typeof window>`u`?!1:window.self!==parent&&(!e||ne()===e)}var p,ae=o((()=>{({$utils:p}=app),p.iframe={createName:te,getName:ne,getParams:re,isIframe:ie}})),m,oe=o((()=>{({$utils:m}=app),m.is={null:e=>e===null,defined:e=>e!==void 0,undefined:e=>e===void 0,nil:e=>e==null,boolean:e=>typeof e==`boolean`,number:e=>typeof e==`number`,string:e=>typeof e==`string`,symbol:e=>typeof e==`symbol`,function:e=>typeof e==`function`,map:e=>e instanceof Map,set:e=>e instanceof Set,url:e=>e instanceof URL,blob:e=>e instanceof Blob,file:e=>e instanceof File,error:e=>e instanceof Error,regexp:e=>e instanceof RegExp,promise:e=>e instanceof Promise,array:e=>Array.isArray(e),object:e=>Object.prototype.toString.call(e)===`[object Object]`,objectOrArray:e=>m.is.object(e)||m.is.array(e),nan:e=>Number.isNaN(e),numeric:e=>!m.is.nan(Number(e)),empty:e=>m.is.nil(e)?!0:m.is.array(e)?e.length===0:m.is.object(e)?Object.keys(e).length===0:m.is.string(e)?e.trim().length===0:!1}})),h,g,se=o((()=>{({$utils:h,$bus:g}=app),h.objectUrl={create(e,t=!1){if(!URL.createObjectURL)return g.send(`utils.objectUrl.create`,e,t);let n=URL.createObjectURL(e);if(t){let e=h.is.number(t)?t:6e4;setTimeout(()=>URL.revokeObjectURL(n),e)}return n},revoke(e){if(!URL.revokeObjectURL)return g.send(`utils.objectUrl.revoke`,e);URL.revokeObjectURL(e)}}})),ce,le=o((()=>{({$utils:ce}=app),ce.safeJsonParse=e=>{try{return JSON.parse(e)}catch{return null}}})),ue,_,v,y,b,de,fe,pe,me,he,ge,_e=o((()=>{({$utils:ue}=app),_=1e3,v=60*_,y=60*v,b=24*y,de=7*b,fe=31*b,pe=365*b,me=[`Sun`,`Mon`,`Tue`,`Wed`,`Thu`,`Fri`,`Sat`],he=[`January`,`February`,`March`,`April`,`May`,`June`,`July`,`August`,`September`,`October`,`November`,`December`],ge=e=>{let t=e/_,n=e/v,r=e/y,i=e/b;return t<5?`a few seconds`:t<90?`1 minute`:n<45?`${Math.round(n)} minutes`:n<120?`1 hour`:r<24?`${Math.round(r)} hours`:r<48?`1 day`:`${Math.round(i)} days`},ue.time={SECOND:_,MINUTE:v,HOUR:y,DAY:b,WEEK:de,MONTH:fe,YEAR:pe,weekdays:me,months:he,formatDuration:ge}})),ve,ye=o((()=>{({$utils:ve}=app),ve.waitFor=async(e,t=null)=>{let n,r;return typeof t==`number`?(n=t,r=100):t?(n=t.timeout||3e4,r=t.frequency||100):(n=3e4,r=100),await new Promise(async(t,i)=>{let a=await e();if(a){t(a);return}let o=setInterval(async()=>{let n=await e();n&&(clearInterval(o),clearTimeout(s),t(n))},r),s=setTimeout(()=>{clearInterval(o),t(null)},n)})}})),x,S,be=o((()=>{({$env:x,$utils:S}=app),x.controller={init(){let e=app.env,t=this._getLocus();this._production=e===`production`,this._development=e===`development`,Object.assign(x,{version:app.version,backup:this._getBackup(),features:this._getFeatures(),options:this._getOptions(),locus:t,env:e,is:{bg:t===`bg`,cs:t.startsWith(`cs`),csFrame:t===`csFrame`,csMobile:t===`csMobile`,csDesktop:t===`csDesktop`,nj:t===`nj`,os:t===`os`,pp:t.startsWith(`pp`),ppFrame:t===`ppFrame`,ppMobile:t===`ppMobile`,ppDesktop:t===`ppDesktop`,ppPermissions:t===`ppPermissions`,production:this._production,development:this._development}})},logReady(){x.log(`running ${x.locus} ${app.version} ${x.env}`)},_getLocus(){if(location.protocol===`chrome-extension:`)return location.pathname===`/app/bg.js`?`bg`:location.pathname===`/offscreen.html`?`os`:new URL(location.href).searchParams.has(`permissions`)?`ppPermissions`:`ppMobile`;{let e=self.chrome&&chrome.extension;return self.top===self?e?`csDesktop`:`ppDesktop`:self.name===`pp-frame`?e?`csFrame`:`ppFrame`:e?`csMobile`:`nj`}},_getBackup(){return{url:`https://inssist.com/backup`}},_getFeatures(){return{fspring:!0,iframes:!0,log:this._development}},_getOptions(){return{apiUrl:`https://api.inssist.com/api/v1`,domain:`inssist.com`,storefront:this._production?`slashed.onfastspring.com`:`slashed.test.onfastspring.com`,storefrontId:`embedded-inssist`,checkoutContainer:`https://inssist.com`,billingPlans:this._getBillingPlans(),billingProFeaturesList:this._getBillingProFeaturesList(),billingProFeaturesTable:this._getBillingProFeaturesTable(),tagAssist:this._getTagAssist()}},_getBillingPlans(){let e=(e,t)=>!e.tags?.accounts||e.tags.accounts.some(e=>e.id===t?.userId||e.name===t?.username),t=Date.now()-S.time.MONTH-S.time.DAY;return{"inssist-pro-monthly":{type:`subscription`,pricing:{US:{currency:`USD`,price:9.5}},isActive:(n,{allowCancelled:r=!0}={})=>{let{$s:i}=app;if(!(i.billing.orders||[]).filter(e=>e.created>=t).some(t=>t.product===`inssist-pro-monthly`&&e(t,n.auth)))return!1;let a=Date.now(),o=i.billing.subscriptions?.[`inssist-pro-monthly`]||{};return!!(o.state===`active`||o.state===`canceled`&&a<=o.next&&r)}},"inssist-pro-lifetime":{type:`product`,pricing:{US:{currency:`USD`,price:95}},isActive:t=>{let{$s:n}=app;return(n.billing.orders||[]).some(n=>n.product===`inssist-pro-lifetime`&&e(n,t.auth))}},"inssist-pro-infinite":{type:`product`,pricing:{US:{currency:`USD`,price:240}},isActive:()=>{let{$s:e}=app;return(e.billing.orders||[]).some(e=>e.product===`inssist-pro-infinite`)}}}},_getBillingProFeaturesList(){return[{id:`schedule`,icon:`sidebar-mediator.later`,title:`Post Later`,description:`
          Schedule photos, videos, carousels, stories and reels.
          Use Time Slots to schedule content rapidly.
        `},{id:`hashtags`,icon:`sidebar-mediator.hashtags`,title:`Hashtag Assistant`,description:`
          Find effective hashtags to increase your engagement.
          Create hashtag collections.
        `},{id:`reels`,icon:`sidebar-mediator.covers`,title:`Reels and Video Stories`,description:`
          Publish Videos and Video Stories from your desktop PC / Mac.
        `},{id:`music`,icon:`sidebar-mediator.music`,title:`Music, Covers, Ghost View`,description:`
          Add music to your videos. Select or upload custom covers.
          View stories and read DMs anonymously.
        `}]},_getBillingProFeaturesTable(){return[{id:`story`,list:[{title:`PUBLISH PHOTOS, VIDEOS, REELS`,isFree:!0},{title:`PUBLISH PHOTO & VIDEO STORIES`,isFree:!0},{title:`ADD *MENTIONS* TO STORIES`},{title:`ADD *CUSTOM LINKS* TO STORIES`},{title:`ADD *CUSTOM COVERS* TO VIDEOS`},{title:`ADD *MUSIC* TO STORIES`},{title:`ADD *MUSIC* TO VIDEOS`}]},{id:`later`,list:[{title:`POST *LATER*`},{title:`POSTING *CALENDAR & TIME SLOTS*`},{title:`BULK *CSV* SCHEDULING`}]},{id:`inspirations`,list:[{title:`SAVE & REPOST PINNED POSTS`,isFree:!0}]},{id:`templates`,list:[{title:`DM TEMPLATES`,isFree:!0}]},{id:`hashtags`,list:[{title:`HASHTAG ASSIST`,isFree:!0},{title:`HASHTAG *METRICS & COLLECTIONS*`}]},{id:`ghost`,list:[{title:`GHOST MODE *FOR STORIES*`},{title:`GHOST MODE *FOR DM*`}]},{id:`blocker`,list:[{title:`AD BLOCKER`,isFree:!0}]},{id:`scripts`,list:[{title:`*GROWTH* ASSIST`,subtitle:`* available on Monthly Plan`}]}]},_getTagAssist(){return{apiUrl:`https://fc.inssist.com/api/v1/hashtag`,collectionsTagDataTtl:1*S.time.MONTH,maxTagsToQuery:5,maxRelevantTagsToKeep:100,accountStatsTtl:1*S.time.DAY}}}})),C,xe,w,Se=o((()=>{({$bus:C,$env:xe,$utils:w}=app),C.controller={init(){C.on=this.on.bind(this),C.off=this.off.bind(this),C.once=this.once.bind(this),C.send=this._wrapThrowIfError(this.send),C.call=this._wrapThrowIfError(this.call),C.poll=this.poll.bind(this),C.getTabId=this.getTabId.bind(this),C.getWindowId=this.getWindowId.bind(this),this._locus=this._getLocus(),this._serialize=this._serialize.bind(this),this._handlers={},this._is(`ppExt`)?this._setupPpExt():this._is(`bg`)?(this._blobs={},this._channel=new BroadcastChannel(`bus.channel`),this._setupBg()):this._is(`csDesktop`)?(this._token=crypto.randomUUID(),this._setupCsDesktop()):this._is(`ppDesktop`)?(this._token=globalThis.__$busToken__,delete globalThis.__$busToken__,this._setupPpDesktop()):this._is(`os`)?(C.setIframe=this._setIframe.bind(this),this._iframe=null,this._channel=new BroadcastChannel(`bus.channel`),this._setupOs()):this._is(`ppFrame`)&&this._setupPpFrame()},on(e,t,n=null){this._on(e,null,t,n)},off(e,t=null){this._off(e,null,t)},once(e,t){let n=async(...r)=>(this.off(e,n),await t(...r));this.on(e,n)},async send(e,...t){if(!w.is.nan(Number(e))){let n=Number(e);return e=t[0],t=t.slice(1),await this._sendToTab(n,e,...t)}if(this._is(`ppExt`))return await this._sendToExt(e,...t);if(this._is(`ppDesktop`))return await this._sendToPage(e,...t);if(this._is(`ppFrame`))return await this._sendToParent(e,...t);if(this._is(`bg`,`csDesktop`,`os`))return await this._pick([this._sendToExt(e,...t),this._callHandlers({name:e,args:t},e=>e.proxy)])},async call(e,...t){return this._callHandlers({name:e,args:t},e=>!e.proxy)},async poll(e,...t){return await w.waitFor(()=>this.send(e,...t))},async getTabId(){if(this._is(`bg`))return null;let{tabId:e}=await this.send(`bus.getTabData`);return e},async getWindowId(){if(this._is(`bg`))return null;let{windowId:e}=await this.send(`bus.getTabData`);return e},_getLocus(){let e=xe.locus;return e===`ppMobile`||e===`ppPermissions`?`ppExt`:e},_on(e,t,n,r=null){if(this._handlers[e]||(this._handlers[e]=[]),this._is(`csDesktop`,`ppDesktop`,`ppFrame`)&&this._handlers[e].length===0)async:this._sendToProxier(`bus.proxy`,e,!0);let i={fn:n,name:e};t&&(i.proxy=t),r&&(i.this=r),this._handlers[e].push(i)},_off(e,t=null,n=null){if(this._handlers[e]&&(this._handlers[e]=this._handlers[e].filter(e=>{let r=!n||n===e.fn,i=t===(e.proxy||null);return!(r&&i)}),this._handlers[e].length===0&&(delete this._handlers[e],this._is(`csDesktop`,`ppDesktop`,`ppFrame`))))async:this._sendToProxier(`bus.proxy`,e,!1)},_setupPpExt(){chrome.runtime.onMessage.addListener((e,t,n)=>{if(!this._isBusMsg(e))return;let r=this._callHandlers(e);if(r)return r.then(this._serialize).then(n),!0})},_setupBg(){chrome.runtime.onMessage.addListener((e,t,n)=>{if(!this._isBusMsg(e))return;let r=t.tab?.id||null;if(e.name===`bus.proxy`){run:(async()=>{let[t,n]=await this._deserialize(e.argsStr);if(!r)return;let i=`cs-${r}`;n?this._on(t,i,(...e)=>this._sendToTab(r,t,...e)):this._off(t,i)})();return}if(e.name===`bus.removeCsProxies`){this._removeProxyHandlers(`cs-${r}`);return}if(e.name===`bus.getTabData`){let e=t.tab?.windowId||null;return n(this._serialize({tabId:r,windowId:e})),!0}if(e.name===`bus.sendToTab`){run:(async()=>{let t=await this._deserialize(e.argsStr),r=await this._sendToTab(...t);n(this._serialize(r))})();return!0}if(e.name===`bus.blobIdToObjectUrl`){run:(async()=>{let[t]=await this._deserialize(e.argsStr),r=await this._blobIdToObjectUrl(t);n(this._serialize(r))})();return!0}let i=this._callHandlers(e,e=>e.proxy!==`cs-${r}`);if(i)return i.then(this._serialize).then(n),!0}),chrome.tabs.onRemoved.addListener(e=>{this._removeProxyHandlers(`cs-${e}`)})},_setupCsDesktop(){chrome.runtime.onMessage.addListener((e,t,n)=>{if(!this._isBusMsg(e))return;let r=this._callHandlers(e);if(r)return r.then(this._serialize).then(n),!0}),window.addEventListener(`message`,async({data:t})=>{if(this._isBusMsg(t)&&t.locus===`ppDesktop`){if(t.name===`bus.proxy`){let[n,r]=t.args;r?this._on(n,`ppDesktop`,(...e)=>this._sendToPage(n,...e)):this._off(n,`ppDesktop`),e(t);return}e(t,await this._pick([this._sendToExt(t.name,...t.args),this._callHandlers(t,e=>!e.proxy)]))}});let e=(e,t=null)=>{window.postMessage({resId:e.reqId,result:t},`*`)};async:this._sendToProxier(`bus.removeCsProxies`);w.execute(e=>{globalThis.__$busToken__=e},this._token)},_setupPpDesktop(){let e=window.__$bus_njOnMsg__;e&&window.removeEventListener(`message`,e),e=async({data:e})=>{if(!this._isBusMsg(e)||e.locus!==`csDesktop`)return;let t=await this._callHandlers(e);window.postMessage({resId:e.reqId,result:t},`*`)},window.addEventListener(`message`,e),window.__$bus_njOnMsg__=e},_setupOs(){chrome.runtime.onMessage.addListener((e,t,n)=>{if(!this._isBusMsg(e))return;let r=this._callHandlers(e);if(r)return r.then(this._serialize).then(n),!0}),window.addEventListener(`message`,async({data:t})=>{if(this._isBusMsg(t)){if(t.name===`bus.proxy`){let[n,r]=t.args;r?this._on(n,`ppFrame`,(...e)=>this._sendToIframe(n,...e)):this._off(n,`ppFrame`),e(t);return}e(t,await this._pick([this._sendToExt(t.name,...t.args),this._callHandlers(t,e=>!e.proxy)]))}});let e=(e,t=null)=>{this._iframe.contentWindow.postMessage({resId:e.reqId,result:t},`*`)};this._channel.addEventListener(`message`,({data:e})=>{let{blob:t,reqId:n}=e,r=w.objectUrl.create(t,!0);this._channel.postMessage({resId:n,objectUrl:r})})},_setupPpFrame(){window.addEventListener(`message`,async({data:e})=>{if(!this._isBusMsg(e))return;let t=await this._callHandlers(e);window.parent.postMessage({resId:e.reqId,result:t},`*`)})},async _sendToExt(e,...t){let n=this._serialize(t),r=this._createBusMsg({name:e,argsStr:n});try{let e=await chrome.runtime.sendMessage(r);return await this._deserialize(e)}catch(e){return this._isIgnoredExtError(e)||console.error(e),null}},_isIgnoredExtError(e){if(!(e instanceof Error))return!1;let t=(e.message||``).toLowerCase();return t.includes(`receiving end does not exist`)||t.includes(`extension context invalidated`)||t.includes(`closed before a response was received`)},async _sendToTab(e,t,...n){if(!chrome.tabs?.sendMessage)return await this.send(`bus.sendToTab`,e,t,...n);let r=this._serialize(n),i=this._createBusMsg({name:t,argsStr:r});try{let t=await chrome.tabs.sendMessage(e,i);return await this._deserialize(t)}catch(e){return C.error(e),null}},async _sendToPage(e,...t){let n=this._generateId(),r=this._locus,i=this._token,a=this._createBusMsg({name:e,args:t,reqId:n,locus:r,token:i});return window.postMessage(a,`*`),await this._waitForResponseMessage(n)},async _sendToIframe(e,...t){if(!this._iframe)return null;let n=this._generateId(),r=this._createBusMsg({name:e,args:t,reqId:n});return this._iframe.contentWindow.postMessage(r,`*`),await this._waitForResponseMessage(n)},async _sendToParent(e,...t){let n=this._generateId(),r=this._createBusMsg({name:e,args:t,reqId:n});return parent.postMessage(r,`*`),await this._waitForResponseMessage(n)},async _sendToProxier(e,...t){if(this._is(`csDesktop`))return await this._sendToExt(e,...t);if(this._is(`ppDesktop`))return await this._sendToPage(e,...t);if(this._is(`ppFrame`))return await this._sendToParent(e,...t)},async _waitForResponseMessage(e){return await new Promise(t=>{let n=({data:r})=>{r&&r.resId===e&&(window.removeEventListener(`message`,n),t(r.result))};window.addEventListener(`message`,n)})},_callHandlers({name:e,args:t,argsStr:n},r=null){let i=this._handlers[e];return!i||(r&&(i=i.filter(r)),i.length===0)?null:new Promise(async e=>{n&&(t=await this._deserialize(n)),e(await this._pick(i.map(async e=>{try{return await e.fn.call(e.this,...t)}catch(t){return C.error(`failed to handle "${e.name}".`,t),t}})))})},_removeProxyHandlers(e){Object.keys(this._handlers).forEach(t=>{this._handlers[t]=this._handlers[t].filter(t=>t.proxy!==e),this._handlers[t].length===0&&delete this._handlers[t]})},_serialize(e){return w.is.nil(e)?null:this._hasSpecialTypes(e)?`x:${JSON.stringify(e,(e,t)=>{if(w.is.blob(t))if(this._is(`bg`)){let e=this._generateId();return this._blobs[e]=t,`bus.blob.${e}`}else return`bus.blob.${w.objectUrl.create(t,!0)}`;return w.is.error(t)?`bus.error.${t.message}`:t})}`:`f:${JSON.stringify(e)}`},_hasSpecialTypes(e,t=new Set){if(e&&typeof e==`object`){if(t.has(e))return!1;t.add(e)}if(w.is.blob(e)||w.is.error(e))return!0;if(w.is.array(e)){for(let n of e)if(this._hasSpecialTypes(n,t))return!0}if(w.is.object(e)){for(let n in e)if(this._hasSpecialTypes(e[n],t))return!0}return!1},async _deserialize(e){if(!w.is.string(e))return null;let t=e.slice(0,2);if(t===`f:`){let t=e.slice(2);return JSON.parse(t)}let n=t===`x:`?e.slice(2):e,r=new Map,i=JSON.parse(n,(e,t)=>{let n=w.is.string(t);return n&&t.startsWith(`bus.blob.`)?(r.set(t,t.slice(9)),t):n&&t.startsWith(`bus.error.`)?Error(t.slice(10)):t});return await Promise.all([...r.keys()].map(async e=>{let t,n=r.get(e);t=n.startsWith(`blob:`)?n:await this._sendToExt(`bus.blobIdToObjectUrl`,n);let i=await fetch(t).then(e=>e.blob());r.set(e,i)})),this._applyBlobs(i,r)},_applyBlobs(e,t){if(t.has(e))return t.get(e);if(w.is.array(e)||w.is.object(e))for(let n in e)e[n]=this._applyBlobs(e[n],t);return e},async _blobIdToObjectUrl(e){let t=this._blobs[e],n;return w.is.string(t)?n=t:(n=await this._blobToObjectUrl(t),this._blobs[e]=n),setTimeout(()=>delete this._blobs[e],6e4),n},async _blobToObjectUrl(e){let t=this._generateId();return this._channel.postMessage({reqId:t,blob:e}),await new Promise(e=>{let n=({data:r})=>{r&&r.resId===t&&(this._channel.removeEventListener(`message`,n),e(r.objectUrl))};this._channel.addEventListener(`message`,n)})},_is(...e){return e.includes(this._locus)},_isBusMsg(e){return!!(e&&e.$bus===app.name)},_createBusMsg(e){return{$bus:app.name,...e}},_generateId(){return`bus-${Date.now()}-${Math.random().toString(36).slice(2)}`},_wrapThrowIfError(e){return async(...t)=>{let n=await e.call(this,...t);if(w.is.error(n))throw n;return n}},async _pick(e=[]){return e.length===0?null:await new Promise(t=>{let n=0;e.forEach(async r=>{let i=await r;if(!w.is.nil(i))return t(i);if(n===e.length-1)return t(null);n++})})},_setIframe(e){this._iframe&&this._removeProxyHandlers(`ppFrame`),this._iframe=e}}})),Ce=s(((e,t)=>{var n=1;function r(){return n=(n*9301+49297)%233280,n/233280}function i(e){n=e}t.exports={nextValue:r,seed:i}})),T=s(((e,t)=>{var n=Ce(),r=`0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-`,i,a,o;function s(){o=!1}function c(e){if(!e){i!==r&&(i=r,s());return}if(e!==i){if(e.length!==r.length)throw Error(`Custom alphabet for shortid must be `+r.length+` unique characters. You submitted `+e.length+` characters: `+e);var t=e.split(``).filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw Error(`Custom alphabet for shortid must be `+r.length+` unique characters. These characters were not unique: `+t.join(`, `));i=e,s()}}function l(e){return c(e),i}function u(e){n.seed(e),a!==e&&(s(),a=e)}function d(){i||c(r);for(var e=i.split(``),t=[],a=n.nextValue(),o;e.length>0;)a=n.nextValue(),o=Math.floor(a*e.length),t.push(e.splice(o,1)[0]);return t.join(``)}function f(){return o||(o=d(),o)}function ee(e){return f()[e]}function te(){return i||r}t.exports={get:te,characters:l,seed:u,lookup:ee,shuffled:f}})),we=s(((e,t)=>{var n=typeof window==`object`&&(window.crypto||window.msCrypto);t.exports=!n||!n.getRandomValues?function(e){for(var t=[],n=0;n<e;n++)t.push(Math.floor(Math.random()*256));return t}:function(e){return n.getRandomValues(new Uint8Array(e))}})),Te,Ee=o((()=>{Te=`useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict`})),De={};c(De,{customAlphabet:()=>Oe,customRandom:()=>D,nanoid:()=>ke,random:()=>E,urlAlphabet:()=>Te});var E,D,Oe,ke,Ae=o((()=>{Ee(),E=e=>crypto.getRandomValues(new Uint8Array(e)),D=(e,t,n)=>{let r=(2<<Math.log(e.length-1)/Math.LN2)-1,i=-~(1.6*r*t/e.length);return(a=t)=>{let o=``;for(;;){let t=n(i),s=i|0;for(;s--;)if(o+=e[t[s]&r]||``,o.length===a)return o}}},Oe=(e,t=21)=>D(e,t,E),ke=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>(t&=63,t<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+=`-`:e+=`_`,e),``)})),je=s(((e,t)=>{var n=T(),r=we(),i=(Ae(),d(De)).customRandom;function a(e){for(var t=0,a,o=``;!a;)o+=i(n.get(),1,r)(),a=e<16**(t+1),t++;return o}t.exports=a})),Me=s(((e,t)=>{var n=je();T();var r=1567752802062,i=7,a,o;function s(e){var t=``,s=Math.floor((Date.now()-r)*.001);return s===o?a++:(a=0,o=s),t+=n(i),t+=n(e),a>0&&(t+=n(a)),t+=n(s),t}t.exports=s})),Ne=s(((e,t)=>{var n=T();function r(e){return!e||typeof e!=`string`||e.length<6?!1:!RegExp(`[^`+n.get().replace(/[|\\{}()[\]^$+*?.-]/g,`\\$&`)+`]`).test(e)}t.exports=r})),Pe=s(((e,t)=>{t.exports=0})),Fe=s(((e,t)=>{var n=T(),r=Me(),i=Ne(),a=Pe()||0;function o(e){return n.seed(e),t.exports}function s(e){return a=e,t.exports}function c(e){return e!==void 0&&n.characters(e),n.shuffled()}function l(){return r(a)}t.exports=l,t.exports.generate=l,t.exports.seed=o,t.exports.worker=s,t.exports.characters=c,t.exports.isValid=i})),Ie=s(((e,t)=>{t.exports=Fe()})),O,Le=o((()=>{({$utils:O}=app),O.binder={create(e={}){let t={};for(let n in e)this._bind(t,n,e[n]);return t},isBinding(e){return O.is.array(e)&&e.length===2&&O.is.object(e[0])&&O.is.string(e[1])},read(e){return O.get(e[0],e[1])},write(e,t){O.set(e[0],e[1],t)},_bind(e,t,n){if(this.isBinding(n))Reflect.defineProperty(e,t,{enumerable:!0,configurable:!0,get:()=>this.read(n),set:e=>this.write(n,e)});else if(O.is.object(n))for(let r in e[t]={},n)this._bind(e[t],r,n[r]);else e[t]=n}}})),Re,ze=o((()=>{({$utils:Re}=app),Re.canvasToBlob=async(e,{type:t=`image/jpeg`,quality:n=.8}={})=>e.convertToBlob?await e.convertToBlob({type:t,quality:n}):await new Promise((r,i)=>{e.toBlob(e=>{e?r(e):i(`canvas.toBlob failed`)},t,n)})})),Be,Ve=o((()=>{({$utils:Be}=app),Be.clamp=(e,t,n)=>Math.max(e,Math.min(t,n))})),He,Ue=o((()=>{({$utils:He}=app),He.ensureArray=e=>Array.isArray(e)?e:[e]})),k,We,Ge=o((()=>{({$utils:k,$bus:We}=app),k.extractFrame=async(e,t=0)=>{if(typeof document>`u`)return await We.send(`utils.extractFrame`,e,t);let n=await k.objectUrl.create(e),r=document.createElement(`video`);r.src=n,r.muted=!0,await new Promise(e=>r.addEventListener(`loadedmetadata`,e)),r.currentTime=t*r.duration,await new Promise(e=>r.addEventListener(`timeupdate`,e));let i=document.createElement(`canvas`),a=i.getContext(`2d`);return i.width=r.videoWidth,i.height=r.videoHeight,a.drawImage(r,0,0),await new Promise(e=>i.toBlob(e,`image/jpeg`))}})),A,Ke=o((()=>{({$utils:A}=app),A.get=(e,t,n=!0)=>{let r=A.is.string(t)?t.split(`.`):t,i=e;for(let e of r){if(i==null)return;if(A.is.array(i)){let t=Number(e);if(!Number.isNaN(t)){if(t<-i.length||t>=i.length)return;i=i.at(t);continue}}if(n&&A.is.function(i[e])){i=i[e]();continue}i=i[e]}return i}})),qe,Je=o((()=>{({$utils:qe}=app),qe.loadImage=async e=>{let t=await createImageBitmap(e),{width:n,height:r}=t;return{image:t,width:n,height:r,ratio:n/r}}})),j,Ye,Xe=o((()=>{({$utils:j,$bus:Ye}=app),j.loadVideoMetadata=async e=>{if(typeof document>`u`)return await Ye.send(`utils.loadVideoMetadata`,e);let t=typeof e==`string`?e:await j.objectUrl.create(e,!0),n=document.createElement(`video`);n.src=t,n.muted=!0,n.volume=0,n.preload=`metadata`,n.play();let r={};return await new Promise((e,t)=>{n.addEventListener(`loadedmetadata`,async()=>{await j.waitFor(()=>n.webkitAudioDecodedByteCount,100),r.width=n.videoWidth,r.height=n.videoHeight,r.ratio=n.videoWidth/n.videoHeight,r.duration=n.duration,r.hasAudio=n.webkitAudioDecodedByteCount>0,e()}),n.addEventListener(`error`,()=>{t(n.error)})}),n.remove(),r}})),M,N,Ze=o((()=>{({$utils:M,$bus:N}=app),M.ls={get(e,t){if(!this._supported())return N.send(`utils.ls.get`,e,t);let n=localStorage.getItem(e);if(n==null)return t;if(n===`true`)return!0;if(n===`false`)return!1;if(n.startsWith(`[`)||n.startsWith(`{`))return JSON.parse(n);let r=Number(n);return Number.isNaN(r)?n:r},set(e,t){if(!this._supported())return N.send(`utils.ls.set`,e,t);try{typeof t==`string`?localStorage.setItem(e,t):localStorage.setItem(e,JSON.stringify(t))}catch(n){M.error(`ls.set failed`,{key:e,value:t,details:n})}},has(e){return this._supported()?e in localStorage:N.send(`utils.ls.has`,e)},remove(e){if(!this._supported())return N.send(`utils.ls.remove`,e);localStorage.removeItem(e)},_supported(){return!!globalThis.localStorage}}})),Qe,$e=o((()=>{({$utils:Qe}=app),Qe.queue=(e=null)=>{let t;return n=>async(...r)=>{let i=t,a=Promise.withResolvers();t=a,i&&await i.promise;try{let t=await n.call(e,...r);return a.resolve(),t}catch(e){throw a.resolve(),e}}}})),P,et=o((()=>{({$utils:P}=app),P.scaler={async scaleToFitSize(e,t,n,{type:r=`image/jpeg`,quality:i=.8}={}){let{image:a,width:o,height:s}=await P.loadImage(e);if(o<t&&s<n)return e;let c=Math.min(1,t/o),l=Math.min(1,n/s),u=Math.min(c,l),d=new OffscreenCanvas(o*u,s*u);return d.getContext(`2d`).drawImage(a,0,0,o,s,0,0,d.width,d.height),await P.canvasToBlob(d,{type:r,quality:i})},async scaleToFitRatio(e,t,{type:n=`image/jpeg`,quality:r=.8}={}){let{image:i,width:a,height:o,ratio:s}=await P.loadImage(e),c=new OffscreenCanvas(0,0);s>t?(c.width=a,c.height=a/t):(c.height=o,c.width=o*t);let l=c.getContext(`2d`),u=(c.width-a)/2,d=(c.height-o)/2;return l.drawImage(i,u,d,a,o),await P.canvasToBlob(c,{type:n,quality:r})}}})),tt,nt=o((()=>{({$utils:tt}=app),tt.truncate=(e,t)=>e.length<=t?e:`${e.slice(0,t-3)}...`})),F,rt=o((()=>{({$utils:F}=app),F.tryCatch=e=>{if(F.is.promise(e))return e.then(e=>[e,null]).catch(e=>[null,e]);try{let t=e();return F.is.promise(t)?F.tryCatch(t):[t,null]}catch(e){return[null,e]}}})),I,L,it,at=o((()=>{({$type:I,$utils:L,$env:it}=app),I.controller={init(){I.assert=this._assert.bind(this),I.validate=this._validate.bind(this),I.display=this._display.bind(this),I.check=this._check.bind(this),this._OneOf=class extends Array{},this._ArrayOf=class extends Array{}},_assert(e,t){return it.is.production||this._check(e,t)?!0:(I.error({value:e,expected:this._display(t)}),!1)},_validate(e,t,n){if(this._check(e,t))return;let r=Error(n||`Invalid type`);throw Error.captureStackTrace(r,this._validate),r},_display(e){if(L.is.function(e))return String(e).includes(`[native code]`)?e.name.toLowerCase():e;if(L.is.object(e)){let t={};for(let n in e)t[n]=this._display(e[n]);return t}return L.is.array(e)?e.length===1?new this._ArrayOf(this._display(e[0])):new this._OneOf(...e.map(e=>this._display(e))):e},_check(e,t){if(L.binder.isBinding(e)&&(e=L.binder.read(e)),t===`*`||t===e)return!0;if(t===Boolean)return L.is.boolean(e);if(t===Number)return L.is.number(e);if(t===String)return L.is.string(e);if(t===Object)return L.is.object(e);if(t===Array)return L.is.array(e);if(t===Symbol)return L.is.symbol(e);if(t===Function)return L.is.function(e);if(t===Blob)return L.is.blob(e);if(t===null)return L.is.null(e);if(t===void 0)return L.is.undefined(e);if(L.is.function(t))return t(e);if(L.is.array(t)&&t.length===1){if(!L.is.array(e))return!1;for(let n=0;n<e.length;n++)if(!this._check(e[n],t[0]))return!1;return!0}if(L.is.array(t)){for(let n of t)if(this._check(e,n))return!0;return!1}if(L.is.object(t)){if(!L.is.object(e))return!1;let n=new Set;for(let r in t){if(r===`*`)continue;let i=r.endsWith(`?`),a=i?r.slice(0,-1):r;if(n.has(a))return I.error(`duplicate key "${a}"`,t),!1;if(n.add(a),!(i&&L.is.undefined(e[a]))&&!this._check(e[a],t[r]))return!1}for(let n in e){let r=n in t||`${n}?`in t;if(!(`*`in t&&this._check(e[n],t[`*`]))&&!r)return!1}return!0}return!1}}})),R,ot=o((()=>{({$editor:R}=app),R.StickerState={x:Number,y:Number,z:Number,width:Number,height:Number,scale:Number,rotation:Number,variant:String},R.MusicState={duration:Number,source:[`ig`,`tunetank`,`custom`],query:String,found:[Object],error:[String,null],videoVolume:Number,musicVolume:Number,selectedTrackId:[String,Number,`custom`,null],selectedTrackUrl:[String,null],selectedTrackName:[String,null],selectedTrackStart:Number,customTrack:[Object,null],igTrackFileId:[String,null]},R.LinkState={url:String,text:String,...R.StickerState,"*":`*`},R.TextState={content:String,...R.StickerState},R.MentionState={users:[{sticker:R.StickerState,username:String,"*":`*`}],hideStickers:Boolean,"*":`*`},R.LocationState={sticker:R.StickerState,selected:[{name:String,"*":`*`},null],"*":`*`},R.StickerType={type:[`link`,`mention`,`location`,`text`],text:String,...R.StickerState,"*":`*`}})),z,B,st,ct,V,H,lt=o((()=>{({$editor:z,$type:B,$utils:st,$shortid:ct,$bus:V,$env:H}=app),z.stickerController={init(){H.is.os&&V.on(`editor.createStickerOverlay`,this.createOverlay,this)},accent:{link:`#0097fd`,mention:`#ff6f00`,location:`#ad46ff`,text:`#10b981`},variants:[{name:`default`,label:`Default`},{name:`white`,label:`White`},{name:`rainbow`,label:`Rainbow`},{name:`solid`,label:`Solid`},{name:`brand`,label:`Inssist`},{name:`black-text`,label:`Black Text`},{name:`white-text`,label:`White Text`}],style:{base:{gap:`2cqw`,padding:[`2.5cqw`,`3.5cqw`,`2.5cqw`,`2.5cqw`],height:`7.2cqw`,fontFamily:`-apple-system, 'system ui', BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif`},default:{background:`#fff`,iconColor:`var(--accent)`,textColor:`#000`,fontWeight:`500`},brand:{background:`#fff`,iconColor:`#cf2876`,textColor:`#000`,fontWeight:`500`},white:{background:`rgba(255, 255, 255, 0.5)`,iconColor:`#fff`,textColor:`#fff`,fontWeight:`500`},rainbow:{background:`white`,iconColor:`#ff0000`,textColor:[`#ff4500`,`#ffd700`,`#32cd32`,`#1e90ff`,`#ad3bff`],fontWeight:`500`},solid:{background:`#fff`,iconColor:`var(--accent)`,textColor:`var(--accent)`,fontWeight:`500`},"black-text":{background:`transparent`,iconColor:`#000`,textColor:`#000`,fontWeight:`500`},"white-text":{background:`transparent`,iconColor:`#fff`,textColor:`#fff`,fontWeight:`500`}},async createOverlay(e,t,n){if(B.assert(e,[z.StickerType]),H.is.bg)return await V.send(`editor.createStickerOverlay`,e,t,n);let r=new OffscreenCanvas(t,n),i=r.getContext(`2d`);e=e.toSorted((e,t)=>e.z-t.z);for(let r of e){let e=this.render(r,t,n),a=new Blob([e],{type:`image/svg+xml`}),o=URL.createObjectURL(a),s=new Image;s.src=o,await s.decode(),i.drawImage(s,0,0,t,n),URL.revokeObjectURL(o)}return await r.convertToBlob({type:`image/png`})},render(e,t=`100%`,n=`100%`){B.assert(e,z.StickerType);let r=ct.generate(),i=this.accent[e.type],a={...this.style.base,...this.style[e.variant]},o=`translate(${`${(e.x-e.width/2)*100}%`}, ${`${(e.y-e.height/2)*100}%`}) rotate(${e.rotation}turn)`,s=`${`${e.width/2*100}%`} ${`${e.height/2*100}%`}`,c=this._renderDefs({id:r,style:a}),l=this._renderBackground({style:a,width:`${e.width*100}%`,height:`${e.height*100}%`,scale:e.scale,type:e.type,text:e.text}),u=``;e.type!==`text`&&(u=this._renderIcon({type:e.type,style:a,dx:`calc(${a.padding[3]} * ${e.scale})`,dy:`calc(${a.padding[0]} * ${e.scale})`,scale:e.scale}));let d=this._renderText({id:r,style:a,dx:e.type===`text`?`calc(3.0cqw * ${e.scale})`:`calc((${a.padding[3]} + ${a.height} + ${a.gap} + 0.06cqw) * ${e.scale})`,dy:`calc((${a.padding[0]} + 0.5cqw) * ${e.scale})`,scale:e.scale,text:e.text,type:e.type});return`
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="${t}"
        height="${n}"
        style="
          container-type: inline-size;
          filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.12));
          --accent: ${i};
        ">
        ${c}
        <g style="transform: ${o}; transform-origin: ${s};">
          ${l}
          ${u}
          ${d}
        </g>
      </svg>
    `},_renderDefs({id:e,style:t}){let n=st.ensureArray(t.textColor);return`
      <defs>
        <linearGradient id="${e}:text-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
          ${n.map((e,t)=>`<stop offset="${t===0?0:t/(n.length-1)*100}%" stop-color="${e}"/>`).join(``)}
        </linearGradient>
      </defs>
    `},_renderBackground({style:e,width:t,height:n,scale:r,type:i,text:a}){return e.background===`transparent`?null:`
      <rect
        x="0"
        y="0"
        width="${t}"
        height="${n}"
        rx="${3.5*r}%"
        ry="${2*r}%"
        fill="${e.background}"/>
    `},_renderIcon({type:e,style:t,dx:n,dy:r,scale:i}){if(e===`link`)return`
        <g style="transform: translate(${n}, ${r}) scale(${i});">
          <svg
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
            width="${t.height}"
            height="${t.height}">
            <path
              d="M12.7076 18.3639L11.2933 19.7781C9.34072 21.7308 6.1749 21.7308 4.22228 19.7781C2.26966 17.8255 2.26966 14.6597 4.22228 12.7071L5.63649 11.2929M18.3644 12.7071L19.7786 11.2929C21.7312 9.34024 21.7312 6.17441 19.7786 4.22179C17.826 2.26917 14.6602 2.26917 12.7076 4.22179L11.2933 5.636M8.50045 15.4999L15.5005 8.49994"
              fill="none"
              stroke="${t.iconColor}"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"/>
          </svg>
        </g>
      `;if(e===`mention`)return`
        <g style="transform: translate(${n}, ${r}) scale(${i});">
          <svg
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            width="${t.height}"
            height="${t.height}">
            <path
              d="M16 7.99999V13C16 13.7956 16.3161 14.5587 16.8787 15.1213C17.4413 15.6839 18.2043 16 19 16C19.7956 16 20.5587 15.6839 21.1213 15.1213C21.6839 14.5587 22 13.7956 22 13V12C21.9999 9.74302 21.2362 7.55247 19.8333 5.78452C18.4303 4.01658 16.4705 2.77521 14.2726 2.26229C12.0747 1.74936 9.76793 1.99503 7.72734 2.95936C5.68676 3.92368 4.03239 5.54995 3.03325 7.57371C2.03411 9.59748 1.74896 11.8997 2.22416 14.1061C2.69936 16.3125 3.90697 18.2932 5.65062 19.7263C7.39428 21.1593 9.57143 21.9603 11.8281 21.9991C14.0847 22.0379 16.2881 21.3122 18.08 19.94M16 12C16 14.2091 14.2091 16 12 16C9.79086 16 8 14.2091 8 12C8 9.79085 9.79086 7.99999 12 7.99999C14.2091 7.99999 16 9.79085 16 12Z"
              fill="none"
              stroke="${t.iconColor}"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"/>
          </svg>
        </g>
      `;if(e===`location`)return`
        <g style="transform: translate(${n}, ${r}) scale(${i});">
          <svg
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            width="${t.height}"
            height="${t.height}">
            <path
              d="M12 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"
              fill="none"
              stroke="${t.iconColor}"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              />
            <path
              d="M12 22c4-4 8-7.582 8-12a8 8 0 1 0-16 0c0 4.418 4 8 8 12Z"
              fill="none"
              stroke="${t.iconColor}"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"/>
          </svg>
        </g>
      `;if(e===`text`)return`
        <g style="transform: translate(${n}, ${r}) scale(${i});">
          <svg
            viewBox="0 0 24 24"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            width="${t.height}"
            height="${t.height}">
            <path
              d="M4 7C4 6.44772 4.44772 6 5 6H19C19.5523 6 20 6.44772 20 7C20 7.55228 19.5523 8 19 8H13V17C13 17.5523 12.5523 18 12 18C11.4477 18 11 17.5523 11 17V8H5C4.44772 8 4 7.55228 4 7Z"
              fill="${t.iconColor}"/>
          </svg>
        </g>
      `;throw Error(`Unsupported type "${e}"`)},_renderText({id:e,style:t,dx:n,dy:r,scale:i,text:a,type:o}){let s=a.replace(/\n/g,` `);return s.length>50&&(s=s.substring(0,50)+`...`),`
      <text
        fill="url(#${e}:text-gradient)"
        font-size="${t.height}"
        font-weight="${t.fontWeight}"
        font-family="${t.fontFamily}"
        alignment-baseline="hanging"
        style="transform: translate(${n}, ${r}) scale(${i}); -webkit-font-smoothing: antialiased">
        ${this._sanitize(s)}
      </text>
    `},_sanitize(e){let t={"&":`&amp;`,"<":`&lt;`,">":`&gt;`,"'":`&#39;`,'"':`&quot;`,"/":`&#x2F;`};return e.replace(/[&<>'"/]/g,e=>t[e]??e)}}})),ut,dt=o((()=>{({$utils:ut}=app),ut.set=(e,t,n,r={})=>{let{flatten:i,create:a}={flatten:!1,create:!1,...r},o=(t||``).split(`.`),s=e;for(let e=0;e<o.length-1;e++){let t=o[e];if(s==null||Array.isArray(s)&&(t=Number(t),Number.isNaN(t)||t<0||t>=s.length))return!1;a&&!s.hasOwnProperty(t)&&(s[t]={}),s=s[t]}if(s==null)return!1;let c=o.at(-1);if(Array.isArray(s)){if(c=Number(c),Number.isNaN(c)||c<0||c>=s.length)return!1;i?(Array.isArray(n)||(n=[n]),s.splice(c,1,...n)):s[c]=n}else s[c]=n;return!0}})),ft,pt=o((()=>{ft=u(Ie()),app.$shortid=ft.default})),mt=o((()=>{Le(),ze(),Ve(),Ue(),Ge(),Ke(),ae(),oe(),Je(),Xe(),Ze(),se(),$e(),le(),et(),dt(),_e(),nt(),rt(),ye()})),ht=o((()=>{be()})),gt=o((()=>{Se()})),U,W,G,_t=o((()=>{({$offscreen:U,$bus:W,$utils:G}=app),U.controller={init(){this._iframe=null,this._closeTimeout=null,this._ensureFrame=G.queue(this)(this._ensureFrame),U.utilsController.init(),W.on(`offscreen.ensureFrame`,this._ensureFrame,this)},async _ensureFrame(){if(this._iframe){this._renewAutoCloseTimer();return}let e=document.createElement(`iframe`);W.setIframe(e),e.src=`https://instagram.com/graphql/query`,e.name=`pp-frame`,e.width=1512,e.height=857,document.body.append(e),await W.poll(`startup.ppFrameReady`),this._iframe=e,this._renewAutoCloseTimer()},_renewAutoCloseTimer(){clearTimeout(this._closeTimeout),this._closeTimeout=setTimeout(()=>this._closeFrame(),5*G.time.MINUTE)},_closeFrame(){this._iframe.remove(),this._iframe=null}}})),vt,K,q,yt=o((()=>{({$offscreen:vt,$utils:K,$bus:q}=app),vt.utilsController={init(){let e=K.ls;q.on(`utils.ls.get`,e.get,e),q.on(`utils.ls.set`,e.set,e),q.on(`utils.ls.has`,e.has,e),q.on(`utils.ls.remove`,e.remove,e);let t=K.objectUrl;q.on(`utils.objectUrl.create`,t.create,t),q.on(`utils.objectUrl.revoke`,t.revoke,t),q.on(`utils.extractFrame`,K.extractFrame),q.on(`utils.loadVideoMetadata`,K.loadVideoMetadata)}}})),bt=o((()=>{_t(),yt()})),xt,St,Ct,wt=o((()=>{({$timer:xt,$bus:St,$utils:Ct}=app),xt.aliveController={init(){this._keepBgAlive()},_keepBgAlive(){setInterval(()=>St.send(`timer.ping`),20*Ct.time.SECOND)}}})),J,Tt=o((()=>{({$timer:J}=app),J.controller={init(){J.aliveController.init(),J.timingController.init(),J.workerController.init()}}})),Et,Y,Dt=o((()=>{({$timer:Et,$bus:Y}=app),Et.timingController={init(){this._timerIds=new Set,this._intervals={},Y.on(`timer.setTimeout`,this._setTimeout,this),Y.on(`timer.clearTimeout`,this._clearTimeout,this),Y.on(`timer.setInterval`,this._setInterval,this),Y.on(`timer.clearInterval`,this._clearInterval,this)},hasTimers(){return this._timerIds.size>0},async _setTimeout(e,t){this._timerIds.add(e),await new Promise(n=>{setTimeout(()=>{this._timerIds.delete(e),n()},t)})},_clearTimeout(e){this._timerIds.delete(e)},_setInterval(e,t){this._timerIds.add(e),this._intervals[e]=setInterval(()=>{Y.send(`timer.setIntervalCall:${e}`)},t)},_clearInterval(e){this._timerIds.delete(e),clearInterval(this._intervals[e]),delete this._intervals[e]}}})),X,Ot=o((()=>{({$timer:X}=app),X.workerController={init(){this._MAX_ID=2147483647,this._lastId=0,this._idToCallback={},this._setupWorker(`/js/timer-worker.min.js`)},_generateId(){do this._lastId===this._MAX_ID?this._lastId=0:this._lastId++;while(this._idToCallback.hasOwnProperty(this._lastId));return this._lastId},_setupWorker(e){let t=this._idToCallback;try{let n=new Worker(e);window.setInterval=(e,r)=>{let i=this._generateId();return t[i]={callback:e,parameters:Array.prototype.slice.call(arguments,2)},n.postMessage({name:`setInterval`,id:i,time:r}),i},window.clearInterval=e=>{t.hasOwnProperty(e)&&(delete t[e],n.postMessage({name:`clearInterval`,id:e}))},window.setTimeout=(e,r)=>{let i=this._generateId();return t[i]={callback:e,parameters:Array.prototype.slice.call(arguments,2),isTimeout:!0},n.postMessage({name:`setTimeout`,id:i,time:r}),i},window.clearTimeout=e=>{t.hasOwnProperty(e)&&(delete t[e],n.postMessage({name:`clearTimeout`,id:e}))},n.onmessage=e=>{let n=e.data.id;if(!n||!t.hasOwnProperty(n))return;let r=t[n],i=r.parameters,a=r.callback;if(r.isTimeout&&delete t[n],typeof a==`string`)try{a=Function(a)}catch(e){X.error(`error parsing callback code string`,e)}typeof a==`function`&&a.apply(window,i)},n.onerror=e=>{X.error(`worker posted an error event`,e)}}catch(e){X.error(`failed setting up timer worker`,e)}}}})),kt=o((()=>{wt(),Tt(),Dt(),Ot()})),At,Z,Q,jt,Mt=o((()=>{({$ffmpeg:At,$utils:Z,$bus:Q,$shortid:jt}=app),At.controller={DEBUG_LOGS:!1,init(){this._timers={},this._instances={},this._load=Z.queue(this)(this._load),Q.on(`ffmpeg.create`,this._create,this),Q.on(`ffmpeg.addFile`,this._addFile,this),Q.on(`ffmpeg.readFile`,this._readFile,this),Q.on(`ffmpeg.removeFile`,this._removeFile,this),Q.on(`ffmpeg.fileExists`,this._fileExists,this),Q.on(`ffmpeg.run`,this._run,this),Q.on(`ffmpeg.getBitrate`,this._getBitrate,this),Q.on(`ffmpeg.dispose`,this._dispose,this)},async _load(){if(window.FFmpeg)return window.FFmpeg;let e=Promise.withResolvers(),t=document.createElement(`script`);t.src=chrome.runtime.getURL(`/js/ffmpeg/ffmpeg.min.js`),t.onload=()=>e.resolve(),t.onerror=()=>e.reject(Error(`Failed to load FFmpeg script`)),document.head.append(t),await e.promise;let n=await Z.waitFor(()=>window.FFmpeg);if(!n)throw Error(`Failed to load FFmpeg library`);return n},async _create(){let e=(await this._load()).createFFmpeg({log:this.DEBUG_LOGS});await e.load();let t=jt.generate();return this._instances[t]=e,this._setAutoDisposeTimer(t),t},async _addFile(e,t,n){let r=this._getInstance(e);if(!r)return;let i=await window.FFmpeg.fetchFile(n);r.FS(`writeFile`,t,i)},async _readFile(e,t,n){let r=this._getInstance(e);if(!r)return;let i=r.FS(`readFile`,t);return new File([i.buffer],t,{type:n})},async _removeFile(e,t){let n=this._getInstance(e);n&&n.FS(`unlink`,t)},async _fileExists(e,t){let n=this._getInstance(e);if(!n)return;let[,r]=Z.tryCatch(()=>n.FS(`stat`,t));return!r},async _run(e,t,n=null,r=null){let i=this._getInstance(e);if(!i)return;Z.is.array(t)&&(t=t.filter(Boolean).join(` `));let a=t.trim().replace(/\s+/g,` `).split(` `),o=null;if(i.setLogger(e=>{r?.(e),e.type===`fferr`&&e.message.includes(`Error`)&&(o=Error(e.message))}),n){let e=Number(t.split(`-t `)[1]?.split(` `)[0])||null;i.setProgress(t=>{let r;r=Z.is.nan(t.ratio)&&e&&t.time?Z.clamp(0,t.time/e,1):Z.clamp(0,t.ratio,1),Q.call(`ffmpeg.progress[${n}]`,r),Q.send(`ffmpeg.progress[${n}]`,r)})}if(await i.run(...a),o)throw o},async _getBitrate(e,t){if(!this._getInstance(e))return;let n;return await this._run(e,[`-t 1`,`-i ${t}`,`-f null`,`-y /dev/null`],null,e=>{let t=e.message.match(/bitrate: (\d+\.\d+|\d+) kb\/s/);t&&(n=Number(t[1]))}),n},_dispose(e){let t=this._getInstance(e);t&&(Z.tryCatch(()=>t.exit()),delete this._timers[e],delete this._instances[e])},_setAutoDisposeTimer(e){clearTimeout(this._timers[e]),this._timers[e]=setTimeout(()=>this._dispose(e),10*Z.time.MINUTE)},_getInstance(e){let t=this._instances[e];return t?(this._setAutoDisposeTimer(e),t):null}}})),Nt=o((()=>{Mt()})),Pt=o((()=>{at()})),Ft,It=o((()=>{({$editor:Ft}=app),Ft.controller={init(){Ft.stickerController.init()}}})),Lt=o((()=>{ot(),It(),lt()})),Rt,zt,Bt,Vt,$,Ht,Ut,Wt,Gt=o((()=>{({$startup:Rt,$bus:zt,$offscreen:Bt,$timer:Vt,$env:$,$ffmpeg:Ht,$type:Ut,$editor:Wt}=app),Rt.controller={async init(){await $.controller.init(),await zt.controller.init(),await Vt.controller.init(),await Ut.controller.init(),await Bt.controller.init(),await Ht.controller.init(),await Wt.controller.init(),zt.on(`startup.osReady`,()=>!0),$.controller.logReady()}},Rt.controller.init()})),Kt=o((()=>{pt(),mt(),ht(),gt(),bt(),kt(),Nt(),Pt(),Lt(),Gt()}));o((()=>{ee(),Kt()}))()})();